# minishogi-rs

5x5 ミニ将棋の Rust 実装。人間 vs AI で対局できます。

AI は **Alpha-Beta 探索**と**モンテカルロ木探索 (MCTS)** の2種類から選択可能です。

## ビルド・実行

```bash
cargo build --release
cargo run --release
```

外部クレートへの依存はありません。

## 遊び方

起動すると、手番とAIアルゴリズムを選択して対局が始まります。

### 入力形式

| 操作 | 形式 | 例 |
|------|------|----|
| 移動 | `<from> <to>` | `1d 1c` |
| 成り | `<from> <to>+` | `5e 5a+` |
| 駒打ち | `drop <駒> <位置>` | `drop 金 3c` |
| 終了 | `quit` | |

座標は `<筋><段>` の形式で、筋は `1`~`5`（右から左）、段は `a`~`e`（上から下）です。

### 駒の表記

| 駒 | 通常 | 成駒 |
|----|------|------|
| 王将 | 王 | - |
| 金将 | 金 | - |
| 銀将 | 銀 | 全 |
| 角行 | 角 | 馬 |
| 飛車 | 飛 | 龍 |
| 歩兵 | 歩 | と |

盤面では先手の駒は ` 王` のように表示され、後手の駒は `^王` と `^` 付きで表示されます。
直前の手の移動先には `*` マークが付きます。

## 対局例

```
=== 5×5 Mini Shogi Start ===

あなたの手番を選んでください:
  s: 先手（先攻）
  g: 後手（後攻）
> s

AIアルゴリズムを選んでください:
  1: Alpha-Beta探索（評価関数ベース）
  2: MCTS（モンテカルロ木探索）
> 1

後手の持ち駒: なし

     5   4   3   2   1
   +---+---+---+---+---+
 a|^王|^金|^銀|^角|^飛|
   +---+---+---+---+---+
 b|^歩| . | . | . | . |
   +---+---+---+---+---+
 c| . | . | . | . | . |
   +---+---+---+---+---+
 d| . | . | . | . | 歩|
   +---+---+---+---+---+
 e| 飛| 角| 銀| 金| 王|
   +---+---+---+---+---+

先手の持ち駒: なし

先手（あなた）の番です
> 1d 1c

後手の持ち駒: なし

     5   4   3   2   1
   +---+---+---+---+---+
 a|^王|^金|^銀|^角|^飛|
   +---+---+---+---+---+
 b|^歩| . | . | . | . |
   +---+---+---+---+---+
 c| . | . | . | . |*歩|
   +---+---+---+---+---+
 d| . | . | . | . | . |
   +---+---+---+---+---+
 e| 飛| 角| 銀| 金| 王|
   +---+---+---+---+---+

先手の持ち駒: なし

後手（AI）の番です。思考中...
AIの手: 1a 1c

後手の持ち駒: 歩1

     5   4   3   2   1
   +---+---+---+---+---+
 a|^王|^金|^銀|^角| . |
   +---+---+---+---+---+
 b|^歩| . | . | . | . |
   +---+---+---+---+---+
 c| . | . | . | . |*飛|
   +---+---+---+---+---+
 d| . | . | . | . | . |
   +---+---+---+---+---+
 e| 飛| 角| 銀| 金| 王|
   +---+---+---+---+---+

先手の持ち駒: なし
```

## AI アルゴリズム

### Alpha-Beta 探索

評価関数に基づく深さ 4 の minimax 探索に Alpha-Beta 枝刈りを適用しています。

- **評価関数**: 駒の価値（歩=100, 銀=400, 金=500, 角=600, 飛=700）を基準に、盤上の駒と持ち駒の差分で局面を評価
- **終局判定**: 王が取られた場合は即座に極値を返す

### MCTS（モンテカルロ木探索）

UCB1 に基づくモンテカルロ木探索です。

- **反復回数**: 20,000 回
- **シミュレーション**: 10 手のランダムプレイアウト後、評価関数で局面スコアを算出し sigmoid で勝率に変換
- **手生成の高速化**: プレイアウト内では打ち歩詰めチェックを省略した軽量版を使用
- **乱数**: xorshift64 による高速な擬似乱数生成

## ルール

[5五将棋](https://ja.wikipedia.org/wiki/5%E4%BA%94%E5%B0%86%E6%A3%8B)のルールに従います。

- 5x5 の盤面で、王・金・銀・角・飛・歩の 6 種の駒を使用
- 相手の駒を取ると持ち駒として打てる（駒打ち）
- 敵陣（最奥段）に入ると成れる。歩は最奥段で強制成り
- 二歩・打ち歩詰めは禁止
- 相手の王を取れば勝ち
